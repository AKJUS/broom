<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> • broom</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../tidyverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- tidyverse --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">broom</a>
        <small class="tidyverse">part of the <a href="http://tidyverse.org">tidyverse</a></small>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/broom.html">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/bootstrapping.html">Bootstrapping</a>
    </li>
    <li>
      <a href="../articles/broom_and_dplyr.html">Broom and dplyr</a>
    </li>
    <li>
      <a href="../articles/kmeans.html">K-means</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
        <li>
  <a href="https://github.com/tidyverse/broom">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1></h1>
            
          </div>

    
    
<div class="contents">
<!--
%\VignetteBuilder{knitr::knitr}
%\VignetteEngine{knitr::knitr}
%\VignetteIndexEntry{broom and dplyr}
-->
<div id="broom-and-dplyr" class="section level1">
<h1 class="hasAnchor">
<a href="#broom-and-dplyr" class="anchor"></a>broom and dplyr</h1>
<p>While broom is useful for summarizing the result of a single analysis in a consistent format, it is really designed for high-throughput applications, where you must combine results from multiple analyses. These could be subgroups of data, analyses using different models, bootstrap replicates, permutations, and so on. In particular, it plays well with the <code>group_by</code> and <code>do</code> functions in <code>dplyr</code>.</p>
<p>Let’s try this on a simple dataset, the built-in <code>Orange</code> data.frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(broom)
<span class="kw">library</span>(dplyr)
<span class="kw">data</span>(Orange)

<span class="kw">dim</span>(Orange)</code></pre></div>
<pre><code>## [1] 35  3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(Orange)</code></pre></div>
<pre><code>## Grouped Data: circumference ~ age | Tree
##   Tree  age circumference
## 1    1  118            30
## 2    1  484            58
## 3    1  664            87
## 4    1 1004           115
## 5    1 1231           120
## 6    1 1372           142</code></pre>
<p>This contains 35 observations of three variables: <code>Tree</code>, <code>age</code>, and <code>circumference</code>. <code>Tree</code> is a factor with five levels describing five trees. As might be expected, age and circumference are correlated:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(Orange<span class="op">$</span>age, Orange<span class="op">$</span>circumference)</code></pre></div>
<pre><code>## [1] 0.9135189</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(Orange, <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(age, circumference, <span class="dt">color =</span> Tree)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_path">geom_line</a></span>()</code></pre></div>
<p><img src="broom_and_dplyr_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
<p>Suppose you want to test for correlations individually <em>within</em> each tree. You can do this with dplyr’s <code>group_by</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Orange <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(Tree) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="dt">correlation =</span> <span class="kw">cor</span>(age, circumference))</code></pre></div>
<pre><code>## # A tibble: 5 x 2
##    Tree correlation
##   &lt;ord&gt;       &lt;dbl&gt;
## 1     3   0.9881766
## 2     1   0.9854675
## 3     5   0.9877376
## 4     2   0.9873624
## 5     4   0.9844610</code></pre>
<p>(Note that the correlations are much higher than the aggregated one, and furthermore we can now see it is similar across trees).</p>
<p>Suppose that instead of simply estimating a correlation, we want to perform a hypothesis test with <code>cor.test</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor.test</span>(Orange<span class="op">$</span>age, Orange<span class="op">$</span>circumference)</code></pre></div>
<pre><code>## 
##  Pearson's product-moment correlation
## 
## data:  Orange$age and Orange$circumference
## t = 12.9, df = 33, p-value = 1.931e-14
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.8342364 0.9557955
## sample estimates:
##       cor 
## 0.9135189</code></pre>
<p>This contains multiple values we could want in our output. Some are vectors of length 1, such as the p-value and the estimate, and some are longer, such as the confidence interval. broom’s <code>tidy</code> S3 method, combined with dplyr’s <code>do</code>, makes it easy to summarize the information about each test:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Orange <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(Tree) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/do.html">do</a></span>(<span class="kw"><a href="../reference/tidy.html">tidy</a></span>(<span class="kw">cor.test</span>(.<span class="op">$</span>age, .<span class="op">$</span>circumference)))</code></pre></div>
<pre><code>## # A tibble: 5 x 9
## # Groups:   Tree [5]
##    Tree  estimate statistic      p.value parameter  conf.low conf.high
##   &lt;ord&gt;     &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1     3 0.9881766  14.41188 2.901046e-05         5 0.9189858 0.9983260
## 2     1 0.9854675  12.97258 4.851902e-05         5 0.9012111 0.9979400
## 3     5 0.9877376  14.14686 3.177093e-05         5 0.9160865 0.9982635
## 4     2 0.9873624  13.93129 3.425041e-05         5 0.9136142 0.9982101
## 5     4 0.9844610  12.53575 5.733090e-05         5 0.8946782 0.9977964
## # ... with 2 more variables: method &lt;fctr&gt;, alternative &lt;fctr&gt;</code></pre>
<p>This becomes even more useful when applied to regressions, which give more than one row of output within each model:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Orange <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(Tree) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/do.html">do</a></span>(<span class="kw"><a href="../reference/tidy.html">tidy</a></span>(<span class="kw">lm</span>(age <span class="op">~</span><span class="st"> </span>circumference, <span class="dt">data=</span>.)))</code></pre></div>
<pre><code>## # A tibble: 10 x 6
## # Groups:   Tree [5]
##     Tree          term    estimate  std.error  statistic      p.value
##    &lt;ord&gt;         &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;
##  1     3   (Intercept) -209.512321 85.2682904 -2.4570954 5.743323e-02
##  2     3 circumference   12.038885  0.8353445 14.4118806 2.901046e-05
##  3     1   (Intercept) -264.673437 98.6205569 -2.6837553 4.362351e-02
##  4     1 circumference   11.919245  0.9188029 12.9725813 4.851902e-05
##  5     5   (Intercept)  -54.484097 76.8862788 -0.7086323 5.102144e-01
##  6     5 circumference    8.787132  0.6211365 14.1468610 3.177093e-05
##  7     2   (Intercept) -132.439725 83.1314146 -1.5931369 1.720092e-01
##  8     2 circumference    7.795225  0.5595479 13.9312907 3.425041e-05
##  9     4   (Intercept)  -76.513671 88.2943757 -0.8665747 4.257969e-01
## 10     4 circumference    7.169842  0.5719516 12.5357484 5.733090e-05</code></pre>
<p>You can just as easily perform multiple regressions within each group, as shown here on the <code>mtcars</code> dataset. We group the data into automatic and manual cars (the <code>am</code> column), then perform the regression within each.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(mtcars)
<span class="kw">head</span>(mtcars)</code></pre></div>
<pre><code>##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mtcars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(am) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/do.html">do</a></span>(<span class="kw"><a href="../reference/tidy.html">tidy</a></span>(<span class="kw">lm</span>(wt <span class="op">~</span><span class="st"> </span>mpg <span class="op">+</span><span class="st"> </span>qsec <span class="op">+</span><span class="st"> </span>gear, .)))</code></pre></div>
<pre><code>## # A tibble: 8 x 6
## # Groups:   am [2]
##      am        term    estimate  std.error   statistic      p.value
##   &lt;dbl&gt;       &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
## 1     0 (Intercept)  4.91754623 1.39665675  3.52094116 0.0030879519
## 2     0         mpg -0.19188914 0.04428329 -4.33321746 0.0005909953
## 3     0        qsec  0.09191361 0.09832067  0.93483509 0.3646797728
## 4     0        gear  0.14653754 0.36819363  0.39799041 0.6962441554
## 5     1 (Intercept)  4.28307028 3.45859958  1.23838281 0.2469014834
## 6     1         mpg -0.10098320 0.02943409 -3.43082488 0.0074984578
## 7     1        qsec  0.03983165 0.15112135  0.26357393 0.7980436972
## 8     1        gear -0.02288330 0.34878226 -0.06560912 0.9491232955</code></pre>
<p>What if you want not just the <code>tidy</code> output, but the <code>augment</code> and <code>glance</code> outputs as well, while still performing each regression only once? First, save the modeling result into a column <code>fit</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">regressions &lt;-<span class="st"> </span>mtcars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(cyl) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/do.html">do</a></span>(<span class="dt">fit =</span> <span class="kw">lm</span>(wt <span class="op">~</span><span class="st"> </span>mpg <span class="op">+</span><span class="st"> </span>qsec <span class="op">+</span><span class="st"> </span>gear, .))
regressions</code></pre></div>
<pre><code>## Source: local data frame [3 x 2]
## Groups: &lt;by row&gt;
## 
## # A tibble: 3 x 2
##     cyl      fit
## * &lt;dbl&gt;   &lt;list&gt;
## 1     4 &lt;S3: lm&gt;
## 2     6 &lt;S3: lm&gt;
## 3     8 &lt;S3: lm&gt;</code></pre>
<p>This creates a rowwise data frame. Tidying methods are designed to work seamlessly with rowwise data frames, grouping them and performing tidying on each row:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">regressions <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/tidy.html">tidy</a></span>(fit)</code></pre></div>
<pre><code>## # A tibble: 12 x 6
## # Groups:   cyl [3]
##      cyl        term     estimate  std.error    statistic     p.value
##    &lt;dbl&gt;       &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
##  1     4 (Intercept) -0.772662398 2.22788026 -0.346815047 0.738922522
##  2     4         mpg -0.081831569 0.02381787 -3.435721470 0.010900258
##  3     4        qsec  0.216651715 0.07590773  2.854145649 0.024542352
##  4     4        gear  0.267469618 0.24454173  1.093758587 0.310264464
##  5     6 (Intercept) -7.785808290 3.35484932 -2.320762438 0.103012430
##  6     6         mpg  0.043283282 0.05196724  0.832895538 0.466010439
##  7     6        qsec  0.421998315 0.09136817  4.618657640 0.019102466
##  8     6        gear  0.638320019 0.20524143  3.110093347 0.052877671
##  9     8 (Intercept)  0.005971578 4.27460511  0.001396989 0.998912840
## 10     8         mpg -0.176924561 0.05570852 -3.175897889 0.009888094
## 11     8        qsec  0.369405813 0.19309553  1.913072859 0.084773637
## 12     8        gear  0.142762416 0.31664127  0.450864838 0.661705480</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">regressions <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/augment.html">augment</a></span>(fit)</code></pre></div>
<pre><code>## # A tibble: 32 x 12
## # Groups:   cyl [3]
##      cyl    wt   mpg  qsec  gear  .fitted   .se.fit        .resid
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
##  1     4 2.320  22.8 18.61     4 2.463345 0.1418571 -0.1433447361
##  2     4 3.190  24.4 20.00     4 2.633560 0.1199552  0.5564398892
##  3     4 3.150  22.8 22.90     4 3.392781 0.2989223 -0.2427805952
##  4     4 2.200  32.4 19.47     4 1.864082 0.1738468  0.3359178471
##  5     4 1.615  30.4 18.52     4 1.821926 0.1475401 -0.2069261605
##  6     4 1.835  33.9 19.90     4 1.834495 0.2098610  0.0005049623
##  7     4 2.465  21.5 20.01     3 2.605569 0.2493871 -0.1405685584
##  8     4 1.935  27.3 18.90     4 2.157932 0.1045713 -0.2229316749
##  9     4 2.140  26.0 16.70     5 2.055149 0.2176428  0.0848514414
## 10     4 1.513  30.4 16.90     5 1.738420 0.2009845 -0.2254199999
## # ... with 22 more rows, and 4 more variables: .hat &lt;dbl&gt;, .sigma &lt;dbl&gt;,
## #   .cooksd &lt;dbl&gt;, .std.resid &lt;dbl&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">regressions <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/glance.html">glance</a></span>(fit)</code></pre></div>
<pre><code>## # A tibble: 3 x 12
## # Groups:   cyl [3]
##     cyl r.squared adj.r.squared      sigma statistic     p.value    df
##   &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt; &lt;int&gt;
## 1     4 0.7799131     0.6855901 0.31936726  8.268539 0.010597767     4
## 2     6 0.9699947     0.9399893 0.08729425 32.327394 0.008743763     4
## 3     8 0.6521278     0.5477661 0.51068708  6.248728 0.011614605     4
## # ... with 5 more variables: logLik &lt;dbl&gt;, AIC &lt;dbl&gt;, BIC &lt;dbl&gt;,
## #   deviance &lt;dbl&gt;, df.residual &lt;int&gt;</code></pre>
<p>By combining the estimates and p-values across all groups into the same tidy data frame (instead of, for example, a list of output model objects), a new class of analyses and visualizations becomes straightforward. This includes</p>
<ul>
<li>Sorting by p-value or estimate to find the most significant terms across all tests</li>
<li>P-value histograms</li>
<li>Volcano plots comparing p-values to effect size estimates</li>
</ul>
<p>In each of these cases, we can easily filter, facet, or distinguish based on the <code>term</code> column. In short, this makes the tools of tidy data analysis available for the <em>results</em> of data analysis and models, not just the inputs.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#broom-and-dplyr">broom and dplyr</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="tidyverse">
  <p>broom is a part of the <strong>tidyverse</strong>, an ecosystem of packages designed with common APIs and a shared philosophy. Learn more at <a href="http://tidyverse.org">tidyverse.org</a>.</p>
</div>

<div class="author">
  <p>Developed by David Robinson.</p>
  <p>Site built by <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-67989-18', 'auto');
  ga('send', 'pageview');
</script></footer>
</div>

  </body>
</html>
